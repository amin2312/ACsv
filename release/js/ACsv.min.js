(function(e){"use strict";e["acsv"]=e["acsv"]||{};var w=function(){};w.replace=function(e,t,r){return e.split(t).join(r)};var m=e["acsv"]["Field"]=function(){};var A=e["acsv"]["Table"]=function(){this._selected=null;this._indexSet={};this.body=[];this.head=[];this.content=null};A.Parse=function(e,t,r){if(r==null){r='"'}if(t==null){t=","}var l=A.arrayToRows(A.textToArray(e,t,r));l.content=e;return l};A.textToArray=function(e,t,r){if(r==null){r='"'}if(t==null){t=","}var l=r+r;var i=[];var s=e.length;var n=e;var a=0;while(true){var h=s-a;var u=0;var v=0;var f=[];var c;var d;while(v<h){u=v;d=n.charAt(a+v);if(d=="\n"||d=="\r\n"){++v;break}if(d=="\r"&&n.charAt(a+v+1)=="\n"){v+=2;break}if(d==t){c="";var o=a+v+1;if(o>=s){d="\n"}else{d=n.charAt(o)}if(u==0||d==t||d=="\n"||d=="\r\n"){++v;f.push("")}else if(d=="\r"&&n.charAt(a+v+2)=="\n"){v+=2;f.push("")}else{++v}}else if(d==r){++v;while(true){v=n.indexOf(r,a+v);if(v==-1){console.log("[ACsv] Invalid Double Quote");return null}v-=a;if(n.charAt(a+v+1)==r){v+=2;continue}break}c=n.substring(a+u+1,a+v);c=w.replace(c,l,r);f.push(c);++v}else{var _=n.indexOf(t,a+v);if(_==-1){_=h}else{_-=a}var b=n.indexOf("\r\n",a+v);if(b==-1){b=n.indexOf("\n",a+v);if(b==-1){b=h}else{b-=a}}else{b-=a}v=_;if(b<_){v=b}c=n.substring(a+u,a+v);f.push(c)}}i.push(f);a+=v;if(a>=s){break}}return i};A.arrayToRows=function(e){var t=e.shift();var r=e;var l=[];var i=0;var s=t.length;while(i<s){var n=i++;var a=t[n];var h=a.split(":");var u=new m;u.fullName=a;u.name=h[0];u.type=h[1];l.push(u)}var v=0;var f=r.length;while(v<f){var c=v++;var d=r[c];var o=0;var _=d.length;while(o<_){var b=o++;var w=l[b].type;var g=d[b];var p=g;var y=g==null||g=="";if(w=="bool"){if(y||g=="false"||g=="0"){p=false}else{p=true}}else if(w=="int"){if(y){p=0}else{p=parseInt(p)}}else if(w=="number"){if(y){p=0}else{p=parseFloat(p)}}else if(w=="json"){if(y){p=null}else{var O=g.charAt(0);if(!(O=="["||O=="{")){console.log("[ACsv] Invalid json format:"+l[b].name+","+g);return null}p=g}}else if(w=="strings"){if(y){p="[]"}else{p='["'+g.split(",").join('","')+'"]'}}d[b]=p}r[c]=d}var x=new A;x.head=l;x.body=r;return x};A.prototype={merge:function(e){this.body=this.body.concat(e.body);var t=e.content.indexOf("\r\n");if(t==-1){t=e.content.indexOf("\n")}var r=e.content.substring(t);this.content+=r},createIndexAt:function(e){var t={};var r=0;var l=this.body.length;while(r<l){var i=r++;var s=this.body[i];var n=s[e];t[n]=s}this._indexSet[e]=t},getColIndexBy:function(e){var t=0;var r=this.head.length;while(t<r){var l=t++;var i=this.head[l];if(i.name==e){return l}}return-1},sortBy:function(e,t){var r=this._selected.length;var l=0;var i=r;while(l<i){var s=l++;var n=0;var a=r-1;while(n<a){var h=n++;var u=false;var v=this._selected[h][e];var f=this._selected[h+1][e];if(t==0&&v>f){u=true}else if(t==1&&v<f){u=true}if(u){var c=this._selected[h];this._selected[h]=this._selected[h+1];this._selected[h+1]=c}}}return this},getCurrentSelector:function(){return this._selected},fmtRow:function(e){var t=[];var r=0;var l=this.head.length;while(r<l){var i=r++;var s=this.head[i].type;var n=e[i];var a=null;if(s!=null&&s!=""&&A.JSON_TYPES.indexOf(s)!=-1){if(n!=null){a=JSON.parse(n)}}else{a=n}t.push(a)}return t},fmtObj:function(e){var t={};var r=0;var l=this.head.length;while(r<l){var i=r++;var s=this.head[i].name;var n=this.head[i].type;var a=e[i];var h=null;if(n!=null&&n!=""&&A.JSON_TYPES.indexOf(n)!=-1){if(a!=null){h=JSON.parse(a)}}else{h=a}t[s]=h}return t},toFirstRow:function(){var e=null;if(this._selected!=null&&this._selected.length>0){e=this.fmtRow(this._selected[0])}this._selected=null;return e},toLastRow:function(){var e=null;if(this._selected!=null&&this._selected.length>0){e=this.fmtRow(this._selected[this._selected.length-1])}this._selected=null;return e},toRows:function(){if(this._selected==null){return null}var e=[];var t=0;var r=this._selected.length;while(t<r){var l=t++;var i=this._selected[l];e.push(this.fmtRow(i))}this._selected=null;return e},toFirstObj:function(){var e=null;if(this._selected!=null&&this._selected.length>0){e=this.fmtObj(this._selected[0])}this._selected=null;return e},toLastObj:function(){var e=null;if(this._selected!=null&&this._selected.length>0){e=this.fmtObj(this._selected[this._selected.length-1])}this._selected=null;return e},toObjs:function(){if(this._selected==null){return null}var e=[];var t=0;var r=this._selected.length;while(t<r){var l=t++;var i=this._selected[l];e.push(this.fmtObj(i))}this._selected=null;return e},toTable:function(){if(this._selected==null){return null}var e=new A;e.head=this.head.concat([]);e.body=this._selected;this._selected=null;return e},selectAll:function(){this._selected=this.body;return this},selectFirstRow:function(){this._selected=[this.body[0]];return this},selectLastRow:function(){this._selected=[this.body[this.body.length-1]];return this},selectAt:function(e){var t=[];var r=0;var l=e.length;while(r<l){var i=r++;var s=e[i];if(s>=0&&s<this.body.length){t.push(this.body[s])}}this._selected=t;return this},selectWhenIn:function(e,t,r){if(r==null){r=0}var l=[];var i=0;var s=t.length;while(i<s){var n=i++;var a=t[n];this.selectWhenE(e,a,r,l);this._selected=null}this._selected=l;return this},selectWhenE:function(e,t,r,l){if(r==null){r=0}var i=l;if(i==null){i=[]}if(e==1){var s=this._indexSet[r];if(s!=null){var n=s[t];if(n!=null){i.push(n)}this._selected=i;return this}}var a=this._selected;if(a==null){a=this.body}var h=0;var u=a.length;while(h<u){var v=h++;var f=a[v];if(f[r]==t){i.push(f);--e;if(e==0){break}}}this._selected=i;return this},selectWhenE2:function(e,t,r,l,i){if(i==null){i=0}if(l==null){l=1}var s=this._selected;if(s==null){s=this.body}var n=[];var a=0;var h=s.length;while(a<h){var u=a++;var v=s[u];if(v[i]==t&&v[l]==r){n.push(v);--e;if(e==0){break}}}this._selected=n;return this},selectWhenE3:function(e,t,r,l,i,s,n){if(n==null){n=0}if(s==null){s=1}if(i==null){i=2}var a=this._selected;if(a==null){a=this.body}var h=[];var u=0;var v=a.length;while(u<v){var f=u++;var c=a[f];if(c[n]==t&&c[s]==r&&c[i]==l){h.push(c);--e;if(e==0){break}}}this._selected=h;return this},selectWhenG:function(e,t,r,l){if(l==null){l=0}var i=this._selected;if(i==null){i=this.body}var s=[];var n=0;var a=i.length;while(n<a){var h=n++;var u=i[h];var v=u[l];if(v>r||t&&v==r){s.push(u);--e;if(e==0){break}}}this._selected=s;return this},selectWhenL:function(e,t,r,l){if(l==null){l=0}var i=this._selected;if(i==null){i=this.body}var s=[];var n=0;var a=i.length;while(n<a){var h=n++;var u=i[h];var v=u[l];if(v<r||t&&v==r){s.push(u);--e;if(e==0){break}}}this._selected=s;return this},selectWhenGreaterAndLess:function(e,t,r,l,i,s){if(s==null){s=0}var n=this._selected;if(n==null){n=this.body}var a=[];var h=0;var u=n.length;while(h<u){var v=h++;var f=n[v];var c=f[s];var d=c>l||t&&c==l;var o=c<i||r&&c==i;if(d&&o){a.push(f);--e;if(e==0){break}}}this._selected=a;return this},selectWhenLessOrGreater:function(e,t,r,l,i,s){if(s==null){s=0}var n=this._selected;if(n==null){n=this.body}var a=[];var h=0;var u=n.length;while(h<u){var v=h++;var f=n[v];var c=f[s];var d=c<l||t&&c==l;var o=c>i||r&&c==i;if(d||o){a.push(f);--e;if(e==0){break}}}this._selected=a;return this}};A.JSON_TYPES=["json","strings"]})(typeof exports!="undefined"?exports:typeof window!="undefined"?window:typeof self!="undefined"?self:this);