(function(e){"use strict";e["acsv"]=e["acsv"]||{};var d=function(){};d.replace=function(e,t,r){return e.split(t).join(r)};var x=e["acsv"]["Field"]=function(){};var A=e["acsv"]["Table"]=function(){this._indexSet={};this.body=[];this.head=[]};A.Parse=function(e){var t=A.arrayToRows(A.textToArray(e));t.content=e;return t};A.textToArray=function(e){var t=[];var r=e.length;var i=e;var n=0;while(true){var s=r-n;var l=0;var a=0;var h=[];var u;var v;while(a<s){l=a;v=i.charAt(n+a);if(v=="\n"||v=="\r\n"){++a;break}if(v=="\r"&&i.charAt(n+a+1)=="\n"){a+=2;break}if(v==","){u="";var f=n+a+1;if(f>=r){v="\n"}else{v=i.charAt(f)}if(l==0||v==","||v=="\n"||v=="\r\n"){++a;h.push("")}else if(v=="\r"&&i.charAt(n+a+2)=="\n"){a+=2;h.push("")}else{++a}}else if(v=='"'){++a;while(true){a=i.indexOf('"',n+a);if(a==-1){console.log("[ACsv] Invalid Double Quote");return null}a-=n;if(i.charAt(n+a+1)=='"'){a+=2;continue}break}u=i.substring(n+l+1,n+a);u=d.replace(u,'""','"');h.push(u);++a}else{var o=i.indexOf(",",n+a);if(o==-1){o=s}else{o-=n}var c=i.indexOf("\r\n",n+a);if(c==-1){c=i.indexOf("\n",n+a);if(c==-1){c=s}else{c-=n}}else{c-=n}a=o;if(c<o){a=c}u=i.substring(n+l,n+a);h.push(u)}}t.push(h);n+=a;if(n>=r){break}}return t};A.arrayToRows=function(e){var t=e.shift();var r=e;var i=[];var n=0;var s=t.length;while(n<s){var l=n++;var a=t[l];var h=a.split(":");var u=new x;u.fullName=a;u.name=h[0];u.type=h[1];i.push(u)}var v=0;var f=r.length;while(v<f){var o=v++;var c=r[o];var d=0;var b=c.length;while(d<b){var _=d++;var y=i[_].type;var p=c[_];var w=p;var g=p==null||p=="";if(y=="bool"){if(g||p=="false"||p=="0"){w=false}else{w=true}}else if(y=="int"){if(g){w=0}else{w=parseInt(w)}}else if(y=="number"){if(g){w=0}else{w=parseFloat(w)}}else if(y=="json"){if(g){w=null}else{var O=p.charAt(0);if(!(O=="["||O=="{")){console.log("[ACsv] Invalid json format:"+i[_].name+","+p);return null}w=p}}else if(y=="strings"){if(g){w="[]"}else{w='["'+p.split(",").join('","')+'"]'}}c[_]=w}r[o]=c}var m=new A;m.head=i;m.body=r;return m};A.prototype={merge:function(e){this.body=this.body.concat(e.body);var t=e.content.indexOf("\r\n");if(t==-1){t=e.content.indexOf("\n")}var r=e.content.substring(t);this.content+=r},createIndexAt:function(e){var t={};var r=0;var i=this.body.length;while(r<i){var n=r++;var s=this.body[n];var l=s[e];t[l]=s}this._indexSet[e]=t},getColumnIndexBy:function(e){var t=0;var r=this.head.length;while(t<r){var i=t++;var n=this.head[i];if(n.name==e){return i}}return-1},getCurrentSelectdData:function(){return this._selectd},fmtRow:function(e){var t=[];var r=0;var i=this.head.length;while(r<i){var n=r++;var s=this.head[n].type;var l=e[n];var a=null;if(s!=null&&s!=""&&A.JSON_TYPES.indexOf(s)!=-1){if(l!=null){a=JSON.parse(l)}}else{a=l}t.push(a)}return t},fmtObj:function(e){var t={};var r=0;var i=this.head.length;while(r<i){var n=r++;var s=this.head[n].name;var l=this.head[n].type;var a=e[n];var h=null;if(l!=null&&l!=""&&A.JSON_TYPES.indexOf(l)!=-1){if(a!=null){h=JSON.parse(a)}}else{h=a}t[s]=h}return t},toFirstRow:function(){if(this._selectd==null||this._selectd.length==0){return null}return this.fmtRow(this._selectd[0])},toLastRow:function(){if(this._selectd==null||this._selectd.length==0){return null}return this.fmtRow(this._selectd[this._selectd.length-1])},toRows:function(){if(this._selectd==null){return null}var e=[];var t=0;var r=this._selectd.length;while(t<r){var i=t++;var n=this._selectd[i];e.push(this.fmtRow(n))}return e},toFirstObj:function(){if(this._selectd==null||this._selectd.length==0){return null}return this.fmtObj(this._selectd[0])},toLastObj:function(){if(this._selectd==null||this._selectd.length==0){return null}return this.fmtObj(this._selectd[this._selectd.length-1])},toObjs:function(){if(this._selectd==null){return null}var e=[];var t=0;var r=this._selectd.length;while(t<r){var i=t++;var n=this._selectd[i];e.push(this.fmtObj(n))}return e},selectAll:function(){this._selectd=this.body;return this},selectFirstRow:function(){this._selectd=[this.body[0]];return this},selectLastRow:function(){this._selectd=[this.body[this.body.length-1]];return this},selectWhenE:function(e,t,r){if(r==null){r=0}if(e==1){var i=this._indexSet[r];if(i!=null){var n=i[t];if(n!=null){this._selectd=[n]}else{this._selectd=null}return this}}var s=[];var l=0;var a=this.body.length;while(l<a){var h=l++;var u=this.body[h];if(u[r]==t){s.push(u);--e;if(e==0){break}}}this._selectd=s;return this},selectWhenE2:function(e,t,r,i,n){if(n==null){n=0}if(i==null){i=1}var s=[];var l=0;var a=this.body.length;while(l<a){var h=l++;var u=this.body[h];if(u[n]==t&&u[i]==r){s.push(u);--e;if(e==0){break}}}this._selectd=s;return this},selectWhenE3:function(e,t,r,i,n,s,l){if(l==null){l=0}if(s==null){s=1}if(n==null){n=2}var a=[];var h=0;var u=this.body.length;while(h<u){var v=h++;var f=this.body[v];if(f[l]==t&&f[s]==r&&f[n]==i){a.push(f);--e;if(e==0){break}}}this._selectd=a;return this},selectWhenG:function(e,t,r,i){if(i==null){i=0}var n=[];var s=0;var l=this.body.length;while(s<l){var a=s++;var h=this.body[a];var u=h[i];if(u>r||t&&u==r){n.push(h);--e;if(e==0){break}}}this._selectd=n;return this},selectWhenL:function(e,t,r,i){if(i==null){i=0}var n=[];var s=0;var l=this.body.length;while(s<l){var a=s++;var h=this.body[a];var u=h[i];if(u<r||t&&u==r){n.push(h);--e;if(e==0){break}}}this._selectd=n;return this},selectWhenGreaterAndLess:function(e,t,r,i,n,s){if(s==null){s=0}var l=[];var a=0;var h=this.body.length;while(a<h){var u=a++;var v=this.body[u];var f=v[s];var o=f>i||t&&f==i;var c=f<n||r&&f==n;if(o&&c){l.push(v);--e;if(e==0){break}}}this._selectd=l;return this},selectWhenLessOrGreater:function(e,t,r,i,n,s){if(s==null){s=0}var l=[];var a=0;var h=this.body.length;while(a<h){var u=a++;var v=this.body[u];var f=v[s];var o=f<i||t&&f==i;var c=f>n||r&&f==n;if(o||c){l.push(v);--e;if(e==0){break}}}this._selectd=l;return this}};A.JSON_TYPES=["json","strings"]})(typeof exports!="undefined"?exports:typeof window!="undefined"?window:typeof self!="undefined"?self:this);